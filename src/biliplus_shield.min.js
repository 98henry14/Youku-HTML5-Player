var shield=function(){var e,t=/[\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]/g,i=!0,o=!0,n=null,r=0,s=!1,l=function(e){return document.querySelector(e)},d=null,c=function(e){return 14==e.length&&"k"==e[3]?!0:"D"==e[0]||"d"==e[0]?!0:"0"==e?!0:!1};return obj={init:function(t){if(i){void 0!=t&&(d=t),i=!1,obj.tab(0),void 0==localStorage.shieldList&&(localStorage.shieldList='{"text":[],"user":[],"color":[],"useReg":false,"limit":10,"mode":[],"visitor":false}'),n=JSON.parse(localStorage.shieldList),void 0==n.color&&(n.color=[]),void 0==n.useReg&&(n.useReg=!1),void 0==n.limit&&(n.limit=10),void 0==n.mode&&(n.mode=[]),void 0==n.visitor&&(n.visitor=!1),s=n.useReg,e=n.limit,obj.render();var o,c,a;for(a=$(".shield_tab"),o=0,c=a.length;c>o;o++)a[o].tabNum=o,a[o].addEventListener("mouseenter",function(){obj.tab(this.tabNum)}),a[o].addEventListener("mouseleave",function(e){var t=this.getBoundingClientRect(),i=e.clientX,o=e.clientY;(i-t.left<0||i-t.left>t.width||o-t.top<0||o-t.top>t.height)&&obj.tab(r)}),a[o].addEventListener("click",function(){obj.switchTab(this.tabNum)});l("#useReg").addEventListener("click",function(){s=!s,obj.save(),obj.render(3)}),l("#blockTop").addEventListener("click",function(){obj.mode(5)}),l("#blockBottom").addEventListener("click",function(){obj.mode(4)}),l("#blockVisitor").addEventListener("click",function(){obj.visitor()});var u=!1,v=function(t){if(u){var i=l("#repeat").getBoundingClientRect(),o=Math.round((t.clientX-i.left)/i.width*49+2);2>o||o>51||(e=o,51==e&&(e=0),obj.render(3))}};l("#repeat").addEventListener("mousedown",function(e){u=!0,v(e)}),l("#repeat").addEventListener("mouseup",function(){u=!1,obj.save()}),l("#repeat").addEventListener("touchend",function(){u=!1,obj.save()}),l(".shield").addEventListener("mousemove",v)}},switchTab:function(e){r=e,l(".shield_body_wrapper").style.transform="translateX("+-278*e+"px)",l(".shield_body_wrapper").style.webkitTransform="translateX("+-278*e+"px)"},tab:function(e){var t=l(".shield"),i=t.getBoundingClientRect(),o=l(".shield .shield_tab:nth-of-type("+(e+1)+")>div").getBoundingClientRect(),n=o.left-i.left,r=o.width,s=l(".shield .shield_tab_slash");s.style.left=n+"px",s.style.width=r+"px"},render:function(t){var i=!0,o=0;for(void 0!=t&&(i=!1,o=t);;){switch(o){case 0:var r,d,c,a="";for(r=0,d=n.text.length;d>r;r++)a+='<div class="shield_item"><div class="text">'+n.text[r]+'</div><div class="delete"></div></div>';for(l("#shield_text").innerHTML=a,c=document.querySelectorAll("#shield_text .shield_item .delete"),r=0,d=c.length;d>r;r++)c[r].onclick=obj.del;break;case 1:for(var c,a="",r=0;r<n.user.length;r++)a+='<div class="shield_item"><div class="text">'+n.user[r]+" mid "+crc_engine(n.user[r])+'</div><div class="delete"></div></div>';for(0==r&&(a='<div class="shield_item">'+ABP.Strings.blockUserEmpty+"</div>"),l("#shield_user").innerHTML=a,c=$("#shield_user .shield_item .delete"),r=0,d=c.length;d>r;r++)c[r].onclick=obj.delUser;break;case 2:for(var u,c,a="",r=0;r<n.color.length;r++){for(u=n.color[r].toString(16);u.length<6;)u="0"+u;a+='<div class="shield_color"><div class="color" style="background:#'+u+'">'+n.color[r]+'</div><div class="delete"></div></div>'}for(0==r&&(a='<div class="shield_color">'+ABP.Strings.blockColorEmpty+"</div>"),l("#shield_color").innerHTML=a,c=$("#shield_color .shield_color .delete"),r=0,d=c.length;d>r;r++)c[r].onclick=obj.delColor;break;case 3:l("#useReg").className="shield_toggle"+(s?" on":""),l("#blockTop").className="shield_toggle"+(-1!=n.mode.indexOf(5)?" on":""),l("#blockBottom").className="shield_toggle"+(-1!=n.mode.indexOf(4)?" on":""),l("#blockVisitor").className="shield_toggle"+(n.visitor?" on":"");var v=(e-2)/49,h=e+" "+ABP.Strings.repeatPcs;0==e&&(v=1,h=ABP.Strings.repeatUnlimited),l("#repeat .fill").style.width=100*v+"%",l("#repeat .button").style.left=100*v+"%",l("#repeat .slide_info").innerHTML=h;break;default:return}o++}},save:function(){n.useReg=s,n.limit=e,localStorage.shieldList=JSON.stringify(n),obj.shield()},show:function(){o?$(".shield")[0].setAttribute("class","shield"):$(".shield")[0].setAttribute("class","shield hidden"),o=!o},add:function(){obj.addText(l(".shield_item .new").value),l(".shield_item .new").value=""},addText:function(e){return""==e||-1!=n.text.indexOf(e)?!1:(n.text.push(e),obj.save(),void obj.render(0))},addUser:function(e){return-1!=n.user.indexOf(e)?!1:(n.user.push(e),obj.save(),void obj.render(1))},addColor:function(e){return e=parseInt(e,16),isNaN(e)||-1!=n.color.indexOf(e)?!1:(n.color.push(e),obj.save(),void obj.render(2))},mode:function(e){var t,i=-1==(t=n.mode.indexOf(e));i?n.mode.push(e):n.mode.splice(t,1),obj.save(),obj.render(3)},visitor:function(){n.visitor=!n.visitor,obj.save(),obj.render(3)},del:function(e){var t,i=e.target.parentNode.childNodes[0].innerHTML,o=n.text.indexOf(i);return-1==o?!1:(t=n.text.splice(0,o),n.text=t.concat(n.text.splice(1)),obj.save(),void obj.render(0))},delUser:function(e){var t,i=e.target.parentNode.childNodes[0].innerHTML.split(" ")[0],o=n.user.indexOf(i);return-1==o?!1:(t=n.user.splice(0,o),n.user=t.concat(n.user.splice(1)),obj.save(),void obj.render(1))},delColor:function(e){var t,i=e.target.parentNode.childNodes[0].innerHTML,o=n.color.indexOf(1*i);return-1==o?!1:(t=n.color.splice(0,o),n.color=t.concat(n.color.splice(1)),obj.save(),void obj.render(2))},filter:function(e){return e.isBlocked?!1:(e.filtered||(e.oriSize=e.size,e.filtered=!0),e.size=e.oriSize*abpinst.commentScale,e)},shield:function(){if(null==d)return!1;var i,o,r=d.cmManager.timeline,l=[],a=0,u=[],v=r.length,h={},f=d.cmManager.runline;if(e>0){for(;v>a;a++)try{l.push(r[a].text.replace(t,""))}catch(e){}for(var b=0,m=b,g={};m!=v;){for(;r[b].stime+1e4<r[m].stime;)0==--g[l[b]]&&delete g[l[b]],++b;void 0==g[l[m]]&&(g[l[m]]=0),++g[l[m]]>e&&r[m].mode<=6&&(h[l[m]]=1),++m}}for(i=0;i<n.text.length;i++)u.push(s?new RegExp(n.text[i]):n.text[i]);for(a=0;v>a;a++)if(o=r[a],o.isBlocked=!1,void 0!=h[l[a]]||-1!=n.color.indexOf(o.color)||-1!=n.user.indexOf(o.hash)||-1!=n.mode.indexOf(o.mode)||n.visitor&&c(o.hash))o.isBlocked=!0;else for(i=0;i<u.length;i++)try{null!=o.text.match(u[i])&&(o.isBlocked=!0)}catch(e){}f.forEach(function(e){e.originalData.isBlocked&&e.finish()}),d.renderCommentList()}},obj}();window.shield=shield;/*end*/